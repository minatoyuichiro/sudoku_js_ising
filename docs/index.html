<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Quantum Sudoku Solver</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        body { font-family: 'Courier New', Courier, monospace; background-color: #f8f9fa; padding-bottom: 50px; }
        
        .sudoku-container {
            width: 95%;
            max-width: 500px;
            margin: 20px auto;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«è‡ªä½“ã®è¨­å®šã‚’å›ºå®š */
        .table-bordered { 
            border: 3px solid black !important; 
            background-color: white; 
            table-layout: fixed; /* å„åˆ—ã®å¹…ã‚’å‡ç­‰ã«å›ºå®š */
            width: 100%;
            border-collapse: collapse;
        }

        /* 3x3ã®å¤ªæ  */
        .table-bordered tr:nth-child(3n) { border-bottom: 3px solid black !important; }
        .table-bordered td:nth-child(3n) { border-right: 3px solid black !important; }

        .table td { 
            padding: 0; 
            border: 1px solid #ccc;
            width: 11.11%; /* 9ç­‰åˆ† */
            position: relative;
        }

        /* ãƒã‚¹ç›®ã‚’æ­£æ–¹å½¢ã«ä¿ã¤ãŸã‚ã®ãƒ©ãƒƒãƒ‘ãƒ¼ */
        .cell-wrapper {
            width: 100%;
            padding-top: 100%; /* é«˜ã•ã‚’å¹…ã¨åŒã˜ã«ã™ã‚‹ */
            position: relative;
        }

        /* å…¥åŠ›ã¨å›ç­”ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        input, .answer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: calc(14px + 1.5vw);
            font-weight: bold;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        input { 
            border: 0; background: transparent; text-align: center; 
            z-index: 2; outline: none; -webkit-appearance: none;
        }
        input::-webkit-inner-spin-button, input::-webkit-outer-spin-button { -webkit-appearance: none; }

        .answer { color: skyblue; z-index: 1; pointer-events: none; }

        .btn-custom { font-size: 20px; font-weight: bold; border: 2px solid black; min-width: 120px; }
        
        .explanation {
            max-width: 600px;
            margin: 40px auto;
            text-align: left;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<div class="container text-center">
    <h2 class="mt-4">Quantum Sudoku Solver</h2>
    
    <div class="sudoku-container">
        <table class="table table-bordered" id="main"></table>
    </div>

    <div class="mt-3">
        <button id="sudoku" class="btn btn-outline-dark btn-custom">SOLVE</button>
        <button onclick="location.reload();" class="btn btn-outline-dark btn-custom">CLEAR</button>
    </div>
    <div id="status" class="mt-3" style="font-weight: bold; height: 30px;">Ready</div>

    <div class="explanation">
        <h5>ğŸ® ä½¿ã„æ–¹</h5>
        <ol>
            <li><strong>ãƒ’ãƒ³ãƒˆã‚’å…¥åŠ›:</strong> ç©ºã„ã¦ã„ã‚‹ãƒã‚¹ç›®ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€å•é¡Œã®æ•°å­—ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</li>
            <li><strong>è§£æé–‹å§‹:</strong> <code>SOLVE</code> ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã‚¢ãƒ‹ãƒ¼ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹è¨ˆç®—ãŒå§‹ã¾ã‚Šã¾ã™ã€‚</li>
            <li><strong>çµæœã®è¡¨ç¤º:</strong> è¨ˆç®—ãŒçµ‚ã‚ã‚‹ã¨ã€æ­£è§£ãŒã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼ã®æ•°å­—ã§ä¸€æ–‰ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</li>
        </ol>

        <hr>

        <h5>ğŸŒŒ ã‚¯ã‚©ãƒ³ã‚¿ãƒ ãƒ»ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã¤ã„ã¦</h5>
        <p>ã“ã®ã‚¢ãƒ—ãƒªã¯ã€æ¬¡ä¸–ä»£ã®è¨ˆç®—æŠ€è¡“ã§ã‚ã‚‹ã€Œé‡å­ã‚¢ãƒ‹ãƒ¼ãƒªãƒ³ã‚°ã€ã®ä»•çµ„ã¿ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚</p>
        <ul>
            <li><strong>è†¨å¤§ãªçµ„ã¿åˆã‚ã›ã®æ¢ç´¢:</strong> æ•°ç‹¬ã«ã¯ å¤©æ–‡å­¦çš„ãªæ•°ã®çµ„ã¿åˆã‚ã›ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ãã‚Œã‚‰ã‚’ã€Œã‚¨ãƒãƒ«ã‚®ãƒ¼ã®ä½ã•ã€ã¨ã—ã¦æ‰ãˆã€æœ€ã‚‚å®‰å®šã—ãŸçŠ¶æ…‹ï¼ˆï¼æ­£è§£ï¼‰ã‚’åŠ¹ç‡çš„ã«æ¢ã—å‡ºã—ã¾ã™ã€‚</li>
            <li><strong>ã€Œç†±ã€ã«ã‚ˆã‚‹è„±å‡º:</strong> è¨ˆç®—ä¸­ã«ã€Œæƒœã—ã„ã‘ã‚Œã©é–“é•ã£ã¦ã„ã‚‹çŠ¶æ…‹ï¼ˆå±€æ‰€è§£ï¼‰ã€ã«ãƒãƒã£ã¦ã‚‚ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸Šã®ã€Œç†±ã€ã‚’ä½¿ã£ã¦ãã“ã‹ã‚‰æŠœã‘å‡ºã—ã€çœŸã®æ­£è§£ã¸ã¨è¾¿ã‚Šç€ãã¾ã™ã€‚</li>
        </ul>
        
        <p><small>â€» éå¸¸ã«é›£ã—ã„å•é¡Œã®å ´åˆã€æ•°å›ãƒªãƒˆãƒ©ã‚¤ã‚’ç¹°ã‚Šè¿”ã™ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€ãã‚Œã¯AIãŒã‚ˆã‚Šè‰¯ã„è§£ã‚’æ±‚ã‚ã¦è©¦è¡ŒéŒ¯èª¤ã—ã¦ã„ã‚‹è¨¼æ‹ ã§ã™ã€‚</small></p>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="bqubo.js"></script>

<script>
$(function(){
    // ç›¤é¢ç”Ÿæˆ (cell-wrapperã‚’è¿½åŠ )
    for(var i=0; i<9; i++){
        var row = '<tr>';
        for(var j=0; j<9; j++){
            row += `<td id="cell_${i}_${j}">
                        <div class="cell-wrapper">
                            <input type="number" id="input_${i}_${j}">
                            ${Array.from({length: 9}, (_, k) => `<div class="answer" id="answer_${i}_${j}_${k+1}"></div>`).join('')}
                        </div>
                    </td>`;
        }
        $('#main').append(row + '</tr>');
    }

    // --- (ã“ã“ã‹ã‚‰ä¸‹ã®JavaScriptãƒ­ã‚¸ãƒƒã‚¯ã¯å‰å›ã¨åŒã˜) ---
    $('#sudoku').click(async function(){
        const $btn = $(this).prop('disabled', true);
        const qubo = {};
        const L_SELECT = 15.0; const L_CONSTRAINT = 8.0; const L_FIXED = 35.0;

        const addQ = (i, j, w) => {
            const key = i < j ? i + ',' + j : j + ',' + i;
            qubo[key] = (qubo[key] || 0) + w;
        };

        for (let n = 0; n < 81; n++) {
            for (let k = 0; k < 9; k++) {
                const idx = n * 9 + k;
                addQ(idx, idx, -1 * L_SELECT); 
                for (let k2 = k + 1; k2 < 9; k2++) addQ(idx, n * 9 + k2, 2 * L_SELECT);
            }
        }
        for (let k = 0; k < 9; k++) {
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    for (let m = j + 1; m < 9; m++) {
                        addQ((i * 9 + j) * 9 + k, (i * 9 + m) * 9 + k, 2 * L_CONSTRAINT);
                        addQ((j * 9 + i) * 9 + k, (m * 9 + i) * 9 + k, 2 * L_CONSTRAINT);
                    }
                }
            }
            for (let br = 0; br < 3; br++) {
                for (let bc = 0; bc < 3; bc++) {
                    let cells = [];
                    for (let r = 0; r < 3; r++) {
                        for (let c = 0; c < 3; c++) cells.push((br * 3 + r) * 9 + (bc * 3 + c));
                    }
                    for (let i = 0; i < 9; i++) {
                        for (let j = i + 1; j < 9; j++) addQ(cells[i] * 9 + k, cells[j] * 9 + k, 2 * L_CONSTRAINT);
                    }
                }
            }
        }
        for (let r = 0; r < 9; r++) {
            for (let c = 0; c < 9; c++) {
                const val = $('#input_' + r + '_' + c).val();
                if (val) addQ((r * 9 + c) * 9 + (parseInt(val) - 1), (r * 9 + c) * 9 + (parseInt(val) - 1), -L_FIXED);
            }
        }

        let attempt = 0; let solved = false;
        while (!solved && attempt < 15) {
            attempt++;
            $('#status').text(`Solving... Attempt ${attempt}`);
            $(".answer").text('');
            const solver = new Bqubo(qubo, { kTinit: 15.0, cl: 0.998, rpt: 5000 });
            const finalState = await solver.solve(null);
            let total = 0;
            for (let n = 0; n < 81; n++) {
                for (let k = 0; k < 9; k++) {
                    if (finalState[n * 9 + k] === 1) {
                        $(`#answer_${Math.floor(n/9)}_${n%9}_${k+1}`).text(k + 1);
                        total++;
                    }
                }
            }
            if (total === 81) {
                $('#status').text(`Success! (${attempt} tries)`).css('color', 'green');
                solved = true;
            } else { await new Promise(r => setTimeout(r, 400)); }
        }
        if(!solved) $('#status').text(`Failed. Try again.`).css('color', 'red');
        $btn.prop('disabled', false);
    });
});
</script>
</body>
</html>